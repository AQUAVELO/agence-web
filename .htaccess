<IfModule !mod_rewrite.c>
    # Tentative de chargement forcé (ne marche pas sur toutes les configs)
</IfModule>

<IfModule mod_rewrite.c>
    Options -MultiViews
    RewriteEngine On
    
    # Détection automatique du RewriteBase pour local/prod (accepte les ports)
    <If "%{HTTP_HOST} =~ /^(localhost|127\.0\.0\.1)/">
        RewriteBase /aquavelo/
    </If>
    <Else>
        RewriteBase /
    </Else>

    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^centres/([^/]+)/?$ index.php?p=page&city=$1 [QSA,L]
    RewriteRule ^centres/?$ index.php?p=centers [QSA,L]
    RewriteRule ^aquabiking/?$ index.php?p=aquabiking [QSA,L]
    RewriteRule ^contact/?$ index.php?p=contact [QSA,L]
    RewriteRule ^free/?$ index.php?p=free [QSA,L]
    RewriteRule ^vente_formule/?$ index.php?p=vente_formule [QSA,L]
    RewriteRule ^vente_cryo/?$ index.php?p=vente_cryo [QSA,L]
    RewriteRule ^vente_prix/?$ index.php?p=vente_prix [QSA,L]
    RewriteRule ^vente_prixprod/?$ index.php?p=vente_prixprod [QSA,L]
    RewriteRule ^vente_cryoprod/?$ index.php?p=vente_cryoprod [QSA,L]
</IfModule>

# Si mod_rewrite n'est pas là, on redirige manuellement les erreurs 404 vers l'index
# C'est une solution de secours (Fallback)
ErrorDocument 404 /index.php
