<IfModule mod_rewrite.c>
    Options +FollowSymlinks
    RewriteEngine On
    RewriteBase /

    # 1. EXCLUSIONS : Ne pas réécrire le dossier du FS Bucket et les assets
    # Cette règle permet d'accéder directement aux fichiers stockés dans /cloud
    RewriteRule ^(css|js|images|fonts|uploads|cloud|vendor)/ - [L]
    RewriteRule \.(css|js|jpg|jpeg|png|gif|ico|svg|woff|woff2|ttf|eot|pdf|zip)$ - [L]
    
    # Fichiers PHP utilitaires (accès direct autorisé)
    RewriteCond %{REQUEST_FILENAME} -f
    RewriteRule ^(check_paris12|test_connexion|fix_db_direct|api_handler)\.php$ - [L]

    # 2. REDIRECTIONS SEO : Anciennes pages .php vers URLs propres
    RewriteRule ^(vente_formule|vente_cryo|vente_prix|vente_prixprod|vente_cryoprod)\.php$ $1 [R=301,L]

    # 3. ROUTES VERS index.php (Aquavelo spécifique)
    
    # Processus de vente et Inscription
    RewriteRule ^vente_formule/?$ index.php?p=vente_formule [QSA,L]
    RewriteRule ^vente_cryo/?$ index.php?p=vente_cryo [QSA,L]
    RewriteRule ^vente_prix/?$ index.php?p=vente_prix [QSA,L]
    RewriteRule ^vente_prixprod/?$ index.php?p=vente_prixprod [QSA,L]
    RewriteRule ^vente_cryoprod/?$ index.php?p=vente_cryoprod [QSA,L]
    RewriteRule ^inscription/?$ index.php?p=vente_formule [QSA,L]
    
    # Gestion des centres et villes
    RewriteRule ^centres/([^/]+)/?$ index.php?p=page&city=$1 [QSA,L]
    RewriteRule ^centres/?$ index.php?p=centers [QSA,L]

    # Pages de contenu et divers
    RewriteRule ^(aquabiking|contact|free|franchise|conseilminceur|cryolipolyse)/?$ index.php?p=$1 [QSA,L]

</IfModule>

# Gestion de l'erreur 404
ErrorDocument 404 /index.php
